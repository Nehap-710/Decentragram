{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Neha\\\\dvideo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:\\\\Users\\\\Neha\\\\dvideo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Neha\\\\dvideo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\Neha\\\\dvideo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _assertThisInitialized from\"C:\\\\Users\\\\Neha\\\\dvideo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _createClass from\"C:\\\\Users\\\\Neha\\\\dvideo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Neha\\\\dvideo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Neha\\\\dvideo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import DVideo from'../abis/DVideo.json';import Navbar from'./Navbar';import Main from'./Main';import Web3 from'web3';import'./App.css';//import { create } from 'ipfs-http-client';\n//Declare IPFS\nvar ipfsClient=require('ipfs-http-client');var projectId='2GD4Or24I3moSvhdpfCq1XMwGQb';// <---------- your Infura Project ID\nvar projectSecret='e98dfb3f4918f02969c01757e58e2c01';// <---------- your Infura Secret\n// (for security concerns, consider saving these values in .env files)\n//xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(projectId + \":\" + projectSecret));\nvar auth='Basic '+Buffer.from(projectId+':'+projectSecret).toString('base64');var ipfs=ipfsClient({host:'infura-ipfs.io',protocol:'https',headers:{authorization:auth}});console.log(ipfs);var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);_createClass(App,[{key:\"componentWillMount\",value:function(){var _componentWillMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.loadWeb3();case 2:_context.next=4;return this.loadBlockchainData();case 4:case\"end\":return _context.stop();}}},_callee,this);}));function componentWillMount(){return _componentWillMount.apply(this,arguments);}return componentWillMount;}()},{key:\"loadWeb3\",value:function(){var _loadWeb=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!window.ethereum){_context2.next=6;break;}window.web3=new Web3(window.ethereum);_context2.next=4;return window.ethereum.enable();case 4:_context2.next=7;break;case 6:if(window.web3){window.web3=new Web3(window.web3.currentProvider);}else{window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!');}case 7:case\"end\":return _context2.stop();}}},_callee2);}));function loadWeb3(){return _loadWeb.apply(this,arguments);}return loadWeb3;}()},{key:\"loadBlockchainData\",value:function(){var _loadBlockchainData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var web3,accounts,networkId,networkData,dvideo,videosCount,i,video,latest;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:web3=window.web3;// Load account\n_context3.next=3;return web3.eth.getAccounts();case 3:accounts=_context3.sent;console.log(accounts);this.setState({account:accounts[0]});// Network ID\n_context3.next=8;return web3.eth.net.getId();case 8:networkId=_context3.sent;networkData=DVideo.networks[networkId];if(!networkData){_context3.next=33;break;}dvideo=new web3.eth.Contract(DVideo.abi,networkData.address);this.setState({dvideo:dvideo});_context3.next=15;return dvideo.methods.videoCount().call();case 15:videosCount=_context3.sent;this.setState({videosCount:videosCount});// Load videos, sort by newest\ni=videosCount;case 18:if(!(i>=1)){_context3.next=26;break;}_context3.next=21;return dvideo.methods.videos(i).call();case 21:video=_context3.sent;this.setState({videos:[].concat(_toConsumableArray(this.state.videos),[video])});case 23:i--;_context3.next=18;break;case 26:_context3.next=28;return dvideo.methods.videos(videosCount).call();case 28:latest=_context3.sent;this.setState({currentHash:latest.hash,currentTitle:latest.title});this.setState({loading:false});_context3.next=34;break;case 33:window.alert('DVideo contract not deployed to detected network.');case 34:case\"end\":return _context3.stop();}}},_callee3,this);}));function loadBlockchainData(){return _loadBlockchainData.apply(this,arguments);}return loadBlockchainData;}()}]);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.captureFile=function(event){event.preventDefault();var file=event.target.files[0];var reader=new window.FileReader();reader.readAsArrayBuffer(file);reader.onloadend=function(){_this.setState({buffer:Buffer(reader.result)});console.log('buffer',_this.state.buffer);};};_this.uploadVideo=function(title){console.log(\"Submitting file to IPFS...\");//adding file to the IPFS\nipfs.add(_this.state.buffer,function(error,result){console.log('IPFS result',result);if(error){console.error(error);return;}_this.setState({loading:true});_this.state.dvideo.methods.uploadVideo(result[0].hash,title).send({from:_this.state.account}).on('transactionHash',function(hash){_this.setState({loading:false});});});};_this.changeVideo=function(hash,title){_this.setState({'currentHash':hash});_this.setState({'currentTitle':title});};_this.state={buffer:null,account:'',dvideo:null,videos:[],loading:true,currentHash:null,currentTitle:null};_this.uploadVideo=_this.uploadVideo.bind(_assertThisInitialized(_this));_this.captureFile=_this.captureFile.bind(_assertThisInitialized(_this));_this.changeVideo=_this.changeVideo.bind(_assertThisInitialized(_this));return _this;}_createClass(App,[{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Navbar,{account:this.state.account}),this.state.loading?/*#__PURE__*/React.createElement(\"div\",{id:\"loader\",className:\"text-center mt-5\"},/*#__PURE__*/React.createElement(\"p\",null,\"Loading...\")):/*#__PURE__*/React.createElement(Main,{videos:this.state.videos,uploadVideo:this.uploadVideo,captureFile:this.captureFile,changeVideo:this.changeVideo,currentHash:this.state.currentHash,currentTitle:this.state.currentTitle}));}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["C:/Users/Neha/dvideo/src/components/App.js"],"names":["React","Component","DVideo","Navbar","Main","Web3","ipfsClient","require","projectId","projectSecret","auth","Buffer","from","toString","ipfs","host","protocol","headers","authorization","console","log","App","loadWeb3","loadBlockchainData","window","ethereum","web3","enable","currentProvider","alert","eth","getAccounts","accounts","setState","account","net","getId","networkId","networkData","networks","dvideo","Contract","abi","address","methods","videoCount","call","videosCount","i","videos","video","state","latest","currentHash","hash","currentTitle","title","loading","props","captureFile","event","preventDefault","file","target","files","reader","FileReader","readAsArrayBuffer","onloadend","buffer","result","uploadVideo","add","error","send","on","changeVideo","bind"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport DVideo from '../abis/DVideo.json'\r\nimport Navbar from './Navbar'\r\nimport Main from './Main'\r\nimport Web3 from 'web3';\r\nimport './App.css';\r\n//import { create } from 'ipfs-http-client';\r\n\r\n//Declare IPFS\r\nconst ipfsClient = require('ipfs-http-client')\r\nconst projectId = '2GD4Or24I3moSvhdpfCq1XMwGQb';   // <---------- your Infura Project ID\r\nconst projectSecret = 'e98dfb3f4918f02969c01757e58e2c01';  // <---------- your Infura Secret\r\n// (for security concerns, consider saving these values in .env files)\r\n//xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(projectId + \":\" + projectSecret));\r\nconst auth = 'Basic ' + Buffer.from(projectId + ':' + projectSecret).toString('base64');\r\n\r\n\r\nconst ipfs = ipfsClient({ host: 'infura-ipfs.io', protocol :'https',  headers: {authorization: auth,},})\r\nconsole.log(ipfs)\r\n\r\nclass App extends Component {\r\n\r\n  async componentWillMount() {\r\n    await this.loadWeb3()\r\n    await this.loadBlockchainData()\r\n  }\r\n\r\n  async loadWeb3() {\r\n    if (window.ethereum) {\r\n      window.web3 = new Web3(window.ethereum)\r\n      await window.ethereum.enable()\r\n    }\r\n    else if (window.web3) {\r\n      window.web3 = new Web3(window.web3.currentProvider)\r\n    }\r\n    else {\r\n      window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!')\r\n    }\r\n  }\r\n\r\n  async loadBlockchainData() {\r\n    const web3 = window.web3\r\n    // Load account\r\n    const accounts = await web3.eth.getAccounts()\r\n    console.log(accounts)\r\n    this.setState({ account: accounts[0] })\r\n    // Network ID\r\n    const networkId = await web3.eth.net.getId()\r\n    const networkData = DVideo.networks[networkId]\r\n    if(networkData) {\r\n      const dvideo = new web3.eth.Contract(DVideo.abi, networkData.address)\r\n      this.setState({ dvideo })\r\n      const videosCount = await dvideo.methods.videoCount().call()\r\n      this.setState({ videosCount })\r\n\r\n      // Load videos, sort by newest\r\n      for (var i=videosCount; i>=1; i--) {\r\n        const video = await dvideo.methods.videos(i).call()\r\n        this.setState({\r\n          videos: [...this.state.videos, video]\r\n        })\r\n      }\r\n\r\n      //Set latest video with title to view as default \r\n      const latest = await dvideo.methods.videos(videosCount).call()\r\n      this.setState({\r\n        currentHash: latest.hash,\r\n        currentTitle: latest.title\r\n      })\r\n      this.setState({ loading: false})\r\n    } else {\r\n      window.alert('DVideo contract not deployed to detected network.')\r\n    }\r\n  }\r\n\r\n  captureFile = event => {\r\n    event.preventDefault()\r\n    const file = event.target.files[0]\r\n    const reader = new window.FileReader()\r\n    reader.readAsArrayBuffer(file)\r\n\r\n    reader.onloadend = () => {\r\n      this.setState({ buffer: Buffer(reader.result) })\r\n      console.log('buffer', this.state.buffer)\r\n    }\r\n  }\r\n\r\n\r\n  uploadVideo = title => {\r\n    console.log(\"Submitting file to IPFS...\")\r\n\r\n    //adding file to the IPFS\r\n    ipfs.add(this.state.buffer, (error, result) => {\r\n      console.log('IPFS result', result)\r\n      if(error) {\r\n        console.error(error)\r\n        return\r\n      }\r\n\r\n      this.setState({ loading: true })\r\n      this.state.dvideo.methods.uploadVideo(result[0].hash, title).send({ from: this.state.account }).on('transactionHash', (hash) => {\r\n        this.setState({ loading: false })\r\n      })\r\n    })\r\n  }\r\n\r\n  changeVideo = (hash, title) => {\r\n    this.setState({'currentHash': hash});\r\n    this.setState({'currentTitle': title});\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      buffer: null,\r\n      account: '',\r\n      dvideo: null,\r\n      videos: [],\r\n      loading: true,\r\n      currentHash: null,\r\n      currentTitle: null\r\n    }\r\n\r\n    this.uploadVideo = this.uploadVideo.bind(this)\r\n    this.captureFile = this.captureFile.bind(this)\r\n    this.changeVideo = this.changeVideo.bind(this)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <Navbar \r\n          account={this.state.account}\r\n        />\r\n        { this.state.loading\r\n          ? <div id=\"loader\" className=\"text-center mt-5\"><p>Loading...</p></div>\r\n          : <Main\r\n              videos={this.state.videos}\r\n              uploadVideo={this.uploadVideo}\r\n              captureFile={this.captureFile}\r\n              changeVideo={this.changeVideo}\r\n              currentHash={this.state.currentHash}\r\n              currentTitle={this.state.currentTitle}\r\n            />\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;"]},"metadata":{},"sourceType":"module"}